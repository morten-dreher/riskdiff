<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to the riskdiff package • riskdiff</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the riskdiff package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">riskdiff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to the riskdiff package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to the riskdiff package</h1>
            
      

      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document provides a brief introduction to discrete risk
differences and to the R package <code>riskdiff</code>. First, load the
package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">riskdiff</span><span class="op">)</span></span></code></pre></div>
<p>For comparison of the presented methodology, the <code>rpact</code>
package is used.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rpact.org" class="external-link">rpact</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Installation qualification for rpact 4.2.0 has not yet been performed.</span></span>
<span><span class="co">#&gt; Please run testPackage() before using the package in GxP relevant environments.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exact-risk-differences">Exact risk differences<a class="anchor" aria-label="anchor" href="#exact-risk-differences"></a>
</h2>
<p>Presume that we perform a clinical trial with two groups and a binary
endpoint. This means the comparison of the two rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math>
of the treatment group and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>c</mi></msub><annotation encoding="application/x-tex">\pi_c</annotation></semantics></math>
of the control group. For illustration purposes, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>c</mi></msub><annotation encoding="application/x-tex">\pi_c</annotation></semantics></math>
simply describe the rates of “treatment success” in the treatment and
control group, respectively. In other words, the treatment with the
higher rate is the favourable one for our example and we could formulate
a null hypothesis as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>π</mi><mi>t</mi></msub><mo>≤</mo><msub><mi>π</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">H_0: \pi_t \leq \pi_c</annotation></semantics></math>.
For large enough sample sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>t</mi></msub><annotation encoding="application/x-tex">n_t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>c</mi></msub><annotation encoding="application/x-tex">n_c</annotation></semantics></math>
of treatment and control group, we may use a normal approximation to
answer the research question. However, for very small sample sizes, the
approximation may be inadequate and one may be interested in exact
results. The <code>riskdiff</code> package concerns itself with the
(exact) distribution of risk differences and therefore, these will be
described in detail here. Note that we can rewrite the above null
hypothesis as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>π</mi><mi>t</mi></msub><mo>≤</mo><msub><mi>π</mi><mi>c</mi></msub><mo>⇔</mo><msub><mi>Δ</mi><mi>π</mi></msub><mo>:=</mo><msub><mi>π</mi><mi>t</mi></msub><mo>−</mo><msub><mi>π</mi><mi>c</mi></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_0: \pi_t \leq \pi_c \Leftrightarrow \Delta_\pi:= \pi_t - \pi_c \leq 0</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Δ</mi><mi>π</mi></msub><annotation encoding="application/x-tex">\Delta_\pi</annotation></semantics></math>
denotes the risk difference.</p>
<p>While the risk difference is to be thought of as a real-valued number
between 1 and -1, since it is simply defined by subtracting two rates,
the risk difference observed in a clinical trial is in actuality a
discrete random variable with a finite support. To illustrate this,
presume that we perform an experiment with 4 patients in the treatment
group and 3 patients in the control group (we note that such a trial
will most likely not lead to significant results, but only serves for
illustration purposes here).</p>
<p>For independent patients and groups, we can describe the number of
successes in each group using binomially distributed random variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mo>,</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">i\in\{t,c\}</annotation></semantics></math>
denotes the respective group. Thus,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>t</mi></msub><mo>∼</mo><mi>B</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>4</mn><mo>,</mo><msub><mi>π</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_t \sim Bin(4, \pi_t)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>c</mi></msub><mo>∼</mo><mi>B</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>,</mo><msub><mi>π</mi><mi>c</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_c\sim Bin(3, \pi_c)</annotation></semantics></math>
describe the number of successes in the treatment and control group,
respectively.</p>
<p>In both groups, the number of successes which we can observe is
clearly finite (0, 1, 2, 3, 4 successes in the treatment group and 0, 1,
2, 3 successes in the control group), meaning the observed success rates
are a discrete quantity (0/4, 1/4, 2/4, 3/4, 4/4 in the treatment group
and 0/3, 1/3, 2/3, 3/3 in the control group). Since the observed risk
difference is just the difference of these discrete success rates, it is
also a discrete quantity. The possible values it can take can be
visualised in a table:</p>
<table class="table">
<thead><tr class="header">
<th> </th>
<th>0/4</th>
<th>1/4</th>
<th>2/4</th>
<th>3/4</th>
<th>4/4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0/3</strong></td>
<td>0/12</td>
<td>3/12</td>
<td>6/12</td>
<td>9/12</td>
<td>12/12</td>
</tr>
<tr class="even">
<td><strong>1/3</strong></td>
<td>-4/12</td>
<td>-1/12</td>
<td>2/12</td>
<td>5/12</td>
<td>8/12</td>
</tr>
<tr class="odd">
<td><strong>2/3</strong></td>
<td>-8/12</td>
<td>-5/12</td>
<td>-2/12</td>
<td>1/12</td>
<td>4/12</td>
</tr>
<tr class="even">
<td><strong>3/3</strong></td>
<td>-12/12</td>
<td>-9/12</td>
<td>-6/12</td>
<td>-3/12</td>
<td>0/12</td>
</tr>
</tbody>
</table>
<p>Each table entry is taken by subtracting the number of successes in
the control group (displayed by the row names) from the number of
successes in the treatment group (displayed by the column names). For
ease of presentation, the common denominator 12 is used for all
entries.</p>
<p>From the table, two things become apparent: 1) Not every value can be
reached (e.g., a risk difference of 11/12 is not possible with the given
sample sizes). 2) Some values may occur more than once. For example, a
risk difference of 0/12 can occur either if all patients experience a
treatment success or if all patients experience a treatment failure.
This phenomenon always occurs for a risk difference of 0, regardless of
the sample sizes, and may also occur for other risk differences, if the
group sizes are not coprime (consider group sizes 8 and 4, where a risk
difference of 8/32 can be reached via 8/8 and 3/4 successes, 6/8 and 2/4
successes, 4/8 and 1/4 successes as well as 2/8 and 0/4 successes).</p>
<p>Since the two groups and the patients within them are assumed to be
independent, the probability of each risk difference in the table
occurring is simply calculated by multiplying the marginal
probabilities. Assuming the success probabilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.6</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_c=0.3</annotation></semantics></math>,
the calculation of the probabilities is straightforward. For example,
the probability of the observed risk difference being 12/12 is simply
the probability of observing 4 successes in the treatment group times
the probability of observing 0 successes in the control group:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Δ</mi><mi>π</mi></msub><mo>=</mo><mn>12</mn><mi>/</mi><mn>12</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo>=</mo><mn>4</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>c</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mn>4</mn><mn>4</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mn>0.6</mn><mn>4</mn></msup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mn>3</mn><mn>0</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>0.3</mn><mo stretchy="true" form="postfix">)</mo></mrow><mn>3</mn></msup><mo>=</mo><mn>0.0445</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">
P(\Delta_\pi = 12/12) = P(X_t=4) \cdot P(X_c=0) = \binom{4}{4}0.6^4\cdot \binom{3}{0}(1-0.3)^3 = 0.0445.
</annotation></semantics></math></p>
<p>Completing the table yields the probabilities:</p>
<table class="table">
<thead><tr class="header">
<th> </th>
<th>0/4</th>
<th>1/4</th>
<th>2/4</th>
<th>3/4</th>
<th>4/4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0/3</strong></td>
<td>0.0088</td>
<td>0.0527</td>
<td>0.1185</td>
<td>0.1185</td>
<td>0.0445</td>
</tr>
<tr class="even">
<td><strong>1/3</strong></td>
<td>0.0113</td>
<td>0.0677</td>
<td>0.1524</td>
<td>0.1524</td>
<td>0.0572</td>
</tr>
<tr class="odd">
<td><strong>2/3</strong></td>
<td>0.0048</td>
<td>0.0290</td>
<td>0.0653</td>
<td>0.0653</td>
<td>0.0245</td>
</tr>
<tr class="even">
<td><strong>3/3</strong></td>
<td>0.0007</td>
<td>0.0041</td>
<td>0.0093</td>
<td>0.0093</td>
<td>0.0035</td>
</tr>
</tbody>
</table>
<p>Alternatively, we could calculate a scenario under our aforementioned
null hypothesis, e.g. for equal success rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_t = \pi_c = 0.3</annotation></semantics></math>,
equating to a risk difference
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>π</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\Delta_\pi=0</annotation></semantics></math>.</p>
<p>This yields the probability table:</p>
<table class="table">
<thead><tr class="header">
<th> </th>
<th>0/4</th>
<th>1/4</th>
<th>2/4</th>
<th>3/4</th>
<th>4/4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0/3</strong></td>
<td>0.0824</td>
<td>0.1412</td>
<td>0.0908</td>
<td>0.0259</td>
<td>0.0028</td>
</tr>
<tr class="even">
<td><strong>1/3</strong></td>
<td>0.1059</td>
<td>0.1815</td>
<td>0.1167</td>
<td>0.0333</td>
<td>0.0036</td>
</tr>
<tr class="odd">
<td><strong>2/3</strong></td>
<td>0.0454</td>
<td>0.0778</td>
<td>0.0500</td>
<td>0.0143</td>
<td>0.0015</td>
</tr>
<tr class="even">
<td><strong>3/3</strong></td>
<td>0.0065</td>
<td>0.0111</td>
<td>0.0071</td>
<td>0.0020</td>
<td>0.0002</td>
</tr>
</tbody>
</table>
<p>We may summarise and order these probabilities by their risk
differences. When summarising, we must keep in mind that, as mentioned
above, a risk difference of 0 can be reached by two combinations (all
successes or all failures). Accordingly, we must sum up both
probabilities for the overall probability of a risk difference of 0.
However, note the vast differences of these probabilities: the
probability of all failures is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0824</mn><annotation encoding="application/x-tex">0.0824</annotation></semantics></math>,
whereas the probability of all successes is merely
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0002</mn><annotation encoding="application/x-tex">0.0002</annotation></semantics></math>.
It may be questionable to treat these situations in the same way.
Regardless, this is a feature that occurs when reducing the complexity
of the investigated hypothesis from two dimensions
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>c</mi></msub><annotation encoding="application/x-tex">\pi_c</annotation></semantics></math>)
to one dimension
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Δ</mi><mi>π</mi></msub><annotation encoding="application/x-tex">\Delta_\pi</annotation></semantics></math>).</p>
<table class="table">
<thead><tr class="header">
<th>Risk difference</th>
<th>Probability</th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>-12/12</td>
<td>0.0065</td>
<td></td>
</tr>
<tr class="even">
<td>-9/12</td>
<td>0.0111</td>
<td></td>
</tr>
<tr class="odd">
<td>-8/12</td>
<td>0.0454</td>
<td></td>
</tr>
<tr class="even">
<td>-6/12</td>
<td>0.0071</td>
<td></td>
</tr>
<tr class="odd">
<td>-5/12</td>
<td>0.0778</td>
<td></td>
</tr>
<tr class="even">
<td>-4/12</td>
<td>0.1059</td>
<td></td>
</tr>
<tr class="odd">
<td>-3/12</td>
<td>0.0020</td>
<td></td>
</tr>
<tr class="even">
<td>-2/12</td>
<td>0.0500</td>
<td></td>
</tr>
<tr class="odd">
<td>-1/12</td>
<td>0.1815</td>
<td></td>
</tr>
<tr class="even">
<td>0/12</td>
<td>0.0826</td>
<td></td>
</tr>
<tr class="odd">
<td>1/12</td>
<td>0.0142</td>
<td></td>
</tr>
<tr class="even">
<td>2/12</td>
<td>0.1167</td>
<td></td>
</tr>
<tr class="odd">
<td>3/12</td>
<td>0.1412</td>
<td></td>
</tr>
<tr class="even">
<td>4/12</td>
<td>0.0015</td>
<td></td>
</tr>
<tr class="odd">
<td>5/12</td>
<td>0.0333</td>
<td></td>
</tr>
<tr class="even">
<td>6/12</td>
<td>0.0908</td>
<td></td>
</tr>
<tr class="odd">
<td>8/12</td>
<td>0.0036</td>
<td></td>
</tr>
<tr class="even">
<td>9/12</td>
<td>0.0259</td>
<td></td>
</tr>
<tr class="odd">
<td>12/12</td>
<td>0.0028</td>
<td></td>
</tr>
</tbody>
</table>
<p>Plotting the individual probabilities against the risk difference
yields an interesting picture:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">-</span><span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0065</span>,<span class="fl">0.0111</span>, <span class="fl">0.0454</span>, <span class="fl">0.0071</span>, <span class="fl">0.0778</span>, <span class="fl">0.1059</span>, <span class="fl">0.0020</span>, <span class="fl">0.0500</span>, </span>
<span>           <span class="fl">0.1815</span>, <span class="fl">0.0826</span>, <span class="fl">0.0142</span>, <span class="fl">0.1167</span>, <span class="fl">0.1412</span>, <span class="fl">0.0015</span>, <span class="fl">0.0333</span>, <span class="fl">0.0908</span>, </span>
<span>           <span class="fl">0.0036</span>, <span class="fl">0.0259</span>, <span class="fl">0.0028</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">probs</span>, xlab <span class="op">=</span> <span class="st">"Risk difference"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Risk difference distribution under H0"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">probs</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/plot_driskdiffs-1.png" width="768"></p>
<p>Clearly, the distribution of the risk difference is not symmetric
around 0 under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>.
Furthermore, the probability of observing a risk difference of 0 is
rather low, compared to other values in the vicinity. The reasoning for
this is intuitive, as for the given example of coprime sample sizes, a
risk difference of 0 will only be achieved if a treatment success is
observed for all patients in the trial or if a treatment failure is
observed for all patients in the trial. With the assumed moderate
success probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.3</mn><annotation encoding="application/x-tex">0.3</annotation></semantics></math>,
neither of these events is overwhelmingly likely.</p>
<p>Under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>,
the most likely risk difference to be observed is -1/12, with a
probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.1815</mn><annotation encoding="application/x-tex">0.1815</annotation></semantics></math>.
We may also investigate the cumulative risk difference distribution
under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
by simply using the cumulative sum of the probabilities:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">cumProbs</span>, xlab <span class="op">=</span> <span class="st">"Risk difference"</span>, ylab <span class="op">=</span> <span class="st">"Cumulative Probability"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Cumulative risk difference distribution under H0"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">cumProbs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0.95</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/plot_priskdiffs-1.png" width="768"></p>
<p>As illustrated by the red lines, the risk difference 0 clearly does
not constitute the centre of the distribution, as the probability to
observe a risk difference of at most 0 exceeds 0.5, which would be
expected for a symmetric distribution.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rds</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">cumProbs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.5699</span></span></code></pre></div>
<p>We may design a simple (one-sided) level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
statistical test for this situation by rejecting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
for risk differences with a cumulative probability that exceeds
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">1-\alpha</annotation></semantics></math>.
We use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha=0.05</annotation></semantics></math>
for illustration. Note that for the comparison, we must subtract the
concrete probabilities of achieving the specific risk difference to
maintain the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
level. In the plot above, the blue horizontal line indicates the
cumulative probability of 0.95.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>riskDifference <span class="op">=</span> <span class="va">rds</span>, cumulativeProbability <span class="op">=</span> <span class="va">cumProbs</span>,</span>
<span>                         probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span> <span class="op">+</span> <span class="va">probs</span>,</span>
<span>                         reject <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span> <span class="op">+</span> <span class="va">probs</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">rejectData</span></span>
<span><span class="co">#&gt;    riskDifference cumulativeProbability probGeq reject</span></span>
<span><span class="co">#&gt; 1     -1.00000000                0.0065  1.0000  FALSE</span></span>
<span><span class="co">#&gt; 2     -0.75000000                0.0176  0.9935  FALSE</span></span>
<span><span class="co">#&gt; 3     -0.66666667                0.0630  0.9824  FALSE</span></span>
<span><span class="co">#&gt; 4     -0.50000000                0.0701  0.9370  FALSE</span></span>
<span><span class="co">#&gt; 5     -0.41666667                0.1479  0.9299  FALSE</span></span>
<span><span class="co">#&gt; 6     -0.33333333                0.2538  0.8521  FALSE</span></span>
<span><span class="co">#&gt; 7     -0.25000000                0.2558  0.7462  FALSE</span></span>
<span><span class="co">#&gt; 8     -0.16666667                0.3058  0.7442  FALSE</span></span>
<span><span class="co">#&gt; 9     -0.08333333                0.4873  0.6942  FALSE</span></span>
<span><span class="co">#&gt; 10     0.00000000                0.5699  0.5127  FALSE</span></span>
<span><span class="co">#&gt; 11     0.08333333                0.5841  0.4301  FALSE</span></span>
<span><span class="co">#&gt; 12     0.16666667                0.7008  0.4159  FALSE</span></span>
<span><span class="co">#&gt; 13     0.25000000                0.8420  0.2992  FALSE</span></span>
<span><span class="co">#&gt; 14     0.33333333                0.8435  0.1580  FALSE</span></span>
<span><span class="co">#&gt; 15     0.41666667                0.8768  0.1565  FALSE</span></span>
<span><span class="co">#&gt; 16     0.50000000                0.9676  0.1232  FALSE</span></span>
<span><span class="co">#&gt; 17     0.66666667                0.9712  0.0324   TRUE</span></span>
<span><span class="co">#&gt; 18     0.75000000                0.9971  0.0288   TRUE</span></span>
<span><span class="co">#&gt; 19     1.00000000                0.9999  0.0029   TRUE</span></span></code></pre></div>
<p>In the data frame above, the column <code>probGeq</code> indicates
the probability of achieving a risk difference greater or equal than the
respective value. For a valid (discrete)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
level test, we may only reject risk differences for which this
probability is less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
Using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
can be rejected for risk differences of 0.66 or greater. The true type I
error rate of this test is thus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0324</mn><annotation encoding="application/x-tex">0.0324</annotation></semantics></math>
and the resulting test will be conservative, which is not surprising
given its discrete nature.</p>
<p>We may simulate:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nSims</span> <span class="op">&lt;-</span> <span class="fl">1000000</span></span>
<span></span>
<span><span class="va">successTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">4</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">successControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">3</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskDifferences</span> <span class="op">&lt;-</span> <span class="va">successTreatment</span><span class="op">/</span><span class="fl">4</span> <span class="op">-</span> <span class="va">successControl</span><span class="op">/</span><span class="fl">3</span></span>
<span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">riskDifferences</span> <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.032464</span></span></code></pre></div>
<p>The simulated and theoretical type I error rates are in good
agreement.</p>
<p>We will now attempt a power calculation and simulation for the same
group sizes, but assuming the event rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.6</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.3</annotation></semantics></math>.
The <code><a href="../reference/priskdiff.html">priskdiff()</a></code> and <code><a href="../reference/driskdiff.html">driskdiff()</a></code> functions from
the <code>riskdiff</code> facilitate the calculation and
<code><a href="../reference/plotriskdiff.html">plotriskdiff()</a></code> visualises the result:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">4</span>, nControl <span class="op">=</span> <span class="fl">3</span>, piTreatment <span class="op">=</span> <span class="fl">0.6</span>, piControl <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">4</span>, nControl <span class="op">=</span> <span class="fl">3</span>, piTreatment <span class="op">=</span> <span class="fl">0.6</span>, piControl <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span></span>
<span><span class="co">#&gt;    Risk difference Cumulative probability</span></span>
<span><span class="co">#&gt; 1      -1.00000000              0.0006912</span></span>
<span><span class="co">#&gt; 2      -0.75000000              0.0048384</span></span>
<span><span class="co">#&gt; 3      -0.66666667              0.0096768</span></span>
<span><span class="co">#&gt; 4      -0.50000000              0.0190080</span></span>
<span><span class="co">#&gt; 5      -0.41666667              0.0480384</span></span>
<span><span class="co">#&gt; 6      -0.33333333              0.0593280</span></span>
<span><span class="co">#&gt; 7      -0.25000000              0.0686592</span></span>
<span><span class="co">#&gt; 8      -0.16666667              0.1339776</span></span>
<span><span class="co">#&gt; 9      -0.08333333              0.2017152</span></span>
<span><span class="co">#&gt; 10      0.00000000              0.2139952</span></span>
<span><span class="co">#&gt; 11      0.08333333              0.2793136</span></span>
<span><span class="co">#&gt; 12      0.16666667              0.4317232</span></span>
<span><span class="co">#&gt; 13      0.25000000              0.4844080</span></span>
<span><span class="co">#&gt; 14      0.33333333              0.5089024</span></span>
<span><span class="co">#&gt; 15      0.41666667              0.6613120</span></span>
<span><span class="co">#&gt; 16      0.50000000              0.7798528</span></span>
<span><span class="co">#&gt; 17      0.66666667              0.8370064</span></span>
<span><span class="co">#&gt; 18      0.75000000              0.9555472</span></span>
<span><span class="co">#&gt; 19      1.00000000              1.0000000</span></span>
<span><span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/plotriskdiff.html">plotriskdiff</a></span><span class="op">(</span><span class="va">cumProbs</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/plot_priskdiff_power-1.png" width="768"></p>
<p>From above, we learned that our test rejects for risk differences of
0.66 or greater (or identically for risk differences truly greater than
0.5). We will generally use the “truly greater than” rejection rule
rather than the “greater or equal” rule to avoid possible numerical
inaccuracies. We may now calculate the power of our test for this
situation:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cumProbs</span>, probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rejectData</span></span>
<span><span class="co">#&gt;    Risk difference Cumulative probability   probGeq</span></span>
<span><span class="co">#&gt; 1      -1.00000000              0.0006912 1.0000000</span></span>
<span><span class="co">#&gt; 2      -0.75000000              0.0048384 0.9993088</span></span>
<span><span class="co">#&gt; 3      -0.66666667              0.0096768 0.9951616</span></span>
<span><span class="co">#&gt; 4      -0.50000000              0.0190080 0.9903232</span></span>
<span><span class="co">#&gt; 5      -0.41666667              0.0480384 0.9809920</span></span>
<span><span class="co">#&gt; 6      -0.33333333              0.0593280 0.9519616</span></span>
<span><span class="co">#&gt; 7      -0.25000000              0.0686592 0.9406720</span></span>
<span><span class="co">#&gt; 8      -0.16666667              0.1339776 0.9313408</span></span>
<span><span class="co">#&gt; 9      -0.08333333              0.2017152 0.8660224</span></span>
<span><span class="co">#&gt; 10      0.00000000              0.2139952 0.7982848</span></span>
<span><span class="co">#&gt; 11      0.08333333              0.2793136 0.7860048</span></span>
<span><span class="co">#&gt; 12      0.16666667              0.4317232 0.7206864</span></span>
<span><span class="co">#&gt; 13      0.25000000              0.4844080 0.5682768</span></span>
<span><span class="co">#&gt; 14      0.33333333              0.5089024 0.5155920</span></span>
<span><span class="co">#&gt; 15      0.41666667              0.6613120 0.4910976</span></span>
<span><span class="co">#&gt; 16      0.50000000              0.7798528 0.3386880</span></span>
<span><span class="co">#&gt; 17      0.66666667              0.8370064 0.2201472</span></span>
<span><span class="co">#&gt; 18      0.75000000              0.9555472 0.1629936</span></span>
<span><span class="co">#&gt; 19      1.00000000              1.0000000 0.0444528</span></span></code></pre></div>
<p>According to this calculation, the probability of reaching or
exceeding a risk difference of 0.66 is 0.22, which is the power in this
scenario.</p>
<p>We may simulate:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">successTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">4</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">successControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">3</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskDifferences</span> <span class="op">&lt;-</span> <span class="va">successTreatment</span><span class="op">/</span><span class="fl">4</span> <span class="op">-</span> <span class="va">successControl</span><span class="op">/</span><span class="fl">3</span></span>
<span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">riskDifferences</span> <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.219818</span></span></code></pre></div>
<p>Again, the simulated and theoretical power rates are almost
identical.</p>
<p>We shall now move on to a more realistic trial scenario.</p>
</div>
<div class="section level2">
<h2 id="departure-from-tiny-sample-sizes">Departure from tiny sample sizes<a class="anchor" aria-label="anchor" href="#departure-from-tiny-sample-sizes"></a>
</h2>
<p>In the previous example, we used very small sample sizes of 4 and 3
patients in the treatment and control group, respectively. Apart from
very early phase testing (in which the focus usually does not lie upon
achieving statistical significance), such trial sizes are uncommon in
practice.</p>
<p>Let us instead focus on a trial with slightly larger, but still
relatively small sample sizes. In a rare disease setting, we may
consider a trial with 38 patients in the treatment group and 23 patients
in the control group. The imbalance between the treatment groups does
lower the statistical power, but may not be uncommon in rare diseases in
order to improve recruitment. We will assume a control rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.2</annotation></semantics></math>
and use the null hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>Δ</mi><mi>π</mi></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_0: \Delta_\pi \leq 0</annotation></semantics></math>.</p>
<p>Calculating the distribution of the risk difference under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
is more computationally challenging now, since there are far more
possible risk differences:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">38</span>, nControl <span class="op">=</span> <span class="fl">23</span>, piTreatment <span class="op">=</span> <span class="fl">0.2</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/plotriskdiff.html">plotriskdiff</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/plot_priskdiff_2-1.png" width="768"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">38</span>, nControl <span class="op">=</span> <span class="fl">23</span>, piTreatment <span class="op">=</span> <span class="fl">0.2</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/plotriskdiff.html">plotriskdiff</a></span><span class="op">(</span><span class="va">cumProbs</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/plot_priskdiff_2-2.png" width="768"></p>
<p>The risk difference plots are now messier, but hint at a roughly
symmetric distribution around 0. Formulating a statistical test can be
done in the same manner as before:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    reject <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co"># Save for later</span></span>
<span><span class="va">rejectionRegion</span> <span class="op">&lt;-</span> <span class="va">rejectData</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">605</span><span class="op">:</span><span class="fl">610</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability    probGeq reject</span></span>
<span><span class="co">#&gt; [1,]       0.1647597              0.9420064 0.05799357      0</span></span>
<span><span class="co">#&gt; [2,]       0.1670481              0.9472668 0.05799357      0</span></span>
<span><span class="co">#&gt; [3,]       0.1681922              0.9506886 0.05273319      0</span></span>
<span><span class="co">#&gt; [4,]       0.1693364              0.9506976 0.04931141      1</span></span>
<span><span class="co">#&gt; [5,]       0.1704805              0.9506976 0.04930245      1</span></span>
<span><span class="co">#&gt; [6,]       0.1716247              0.9506976 0.04930245      1</span></span></code></pre></div>
<p>For this setting, we may reject risk differences of 0.1693 or greater
at a level of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>.
The true type I error rate of this test is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0493</mn><annotation encoding="application/x-tex">0.0493</annotation></semantics></math>,
which is much closer to the nominal level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>.</p>
<p>We may again simulate the type I error rate of this trial:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">successTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">38</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">successControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">23</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskDifferences</span> <span class="op">&lt;-</span> <span class="va">successTreatment</span><span class="op">/</span><span class="fl">38</span> <span class="op">-</span> <span class="va">successControl</span><span class="op">/</span><span class="fl">23</span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">riskDifferences</span> <span class="op">&gt;</span> <span class="va">rejectData</span><span class="op">[</span><span class="fl">607</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.049611</span></span></code></pre></div>
<p>The simulated and theoretical type I error rates are in good
agreement.</p>
<p>For a power simulation, we will consider the point alternative
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.4</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.2</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">38</span>, nControl <span class="op">=</span> <span class="fl">23</span>, piTreatment <span class="op">=</span> <span class="fl">0.4</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">38</span>, nControl <span class="op">=</span> <span class="fl">23</span>, piTreatment <span class="op">=</span> <span class="fl">0.4</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Power calculation</span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                    <span class="st">"reject"</span> <span class="op">=</span> <span class="va">rejectionRegion</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">605</span><span class="op">:</span><span class="fl">610</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability   probGeq reject</span></span>
<span><span class="co">#&gt; [1,]       0.1647597              0.3722905 0.6277095      0</span></span>
<span><span class="co">#&gt; [2,]       0.1670481              0.3725310 0.6277095      0</span></span>
<span><span class="co">#&gt; [3,]       0.1681922              0.3936257 0.6274690      0</span></span>
<span><span class="co">#&gt; [4,]       0.1693364              0.4010774 0.6063743      1</span></span>
<span><span class="co">#&gt; [5,]       0.1704805              0.4011103 0.5989226      1</span></span>
<span><span class="co">#&gt; [6,]       0.1716247              0.4011103 0.5988897      1</span></span></code></pre></div>
<p>The theoretical power for this test given the scenario is 0.606.</p>
<p>We simulate:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">successTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">38</span>, <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">successControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">23</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskDifferences</span> <span class="op">&lt;-</span> <span class="va">successTreatment</span><span class="op">/</span><span class="fl">38</span> <span class="op">-</span> <span class="va">successControl</span><span class="op">/</span><span class="fl">23</span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">riskDifferences</span> <span class="op">&gt;</span> <span class="va">rejectData</span><span class="op">[</span><span class="fl">607</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.606107</span></span></code></pre></div>
<p>Again, the simulated power is almost identical to the theoretical
power.</p>
<p>An interesting (yet suspicious) observation is that this power is
remarkably larger than the one achieved by working with a normal
approximation, for example the one implemented in the <code>rpact</code>
package:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">powerRates</span> <span class="op">&lt;-</span> <span class="fu">rpact</span><span class="fu">::</span><span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getPowerRates.html" class="external-link">getPowerRates</a></span><span class="op">(</span></span>
<span>  pi1 <span class="op">=</span> <span class="fl">0.4</span>, pi2 <span class="op">=</span> <span class="fl">0.2</span>, maxNumberOfSubjects <span class="op">=</span> <span class="fl">38</span><span class="op">+</span><span class="fl">23</span>, allocationRatioPlanned <span class="op">=</span> <span class="fl">38</span><span class="op">/</span><span class="fl">23</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">powerRates</span><span class="op">)</span></span></code></pre></div>
<p><em>Power calculation for a binary endpoint</em></p>
<p>Fixed sample analysis, one-sided significance level 5%. The results
were calculated for a two-sample test for rates (normal approximation),
H0: pi(1) - pi(2) = 0, power directed towards larger values, H1: pi(1) =
0.4, control rate pi(2) = 0.2, number of subjects = 61, planned
allocation ratio = 1.652.</p>
<table class="table">
<thead><tr class="header">
<th>Stage</th>
<th>Fixed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Stage level (one-sided)</td>
<td>0.0500</td>
</tr>
<tr class="even">
<td>Efficacy boundary (z-value scale)</td>
<td>1.645</td>
</tr>
<tr class="odd">
<td>Efficacy boundary (t)</td>
<td>0.204</td>
</tr>
<tr class="even">
<td>Power</td>
<td>0.4880</td>
</tr>
<tr class="odd">
<td>Number of subjects</td>
<td>61.0</td>
</tr>
</tbody>
</table>
<p>Legend:</p>
<ul>
<li>
<em>(t)</em>: treatment effect scale</li>
</ul>
<p>Perhaps this stems from an inaccuracy of the normal approximation in
this case, as especially the control group has a small sample size and
small event rate.</p>
<p>We may compare the two tests for different treatment success
rates:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">piTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.005</span><span class="op">)</span></span>
<span><span class="va">powerERD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">piTreatment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">piTreatment</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">38</span>, nControl <span class="op">=</span> <span class="fl">23</span>, piTreatment <span class="op">=</span> <span class="va">piTreatment</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span>  <span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">38</span>, nControl <span class="op">=</span> <span class="fl">23</span>, piTreatment <span class="op">=</span> <span class="va">piTreatment</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                      <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                      probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                      <span class="st">"reject"</span> <span class="op">=</span> <span class="va">rejectionRegion</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">powerERD</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rejectData</span><span class="op">[</span><span class="fl">608</span>, <span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">powerRpact</span> <span class="op">&lt;-</span> <span class="fu">rpact</span><span class="fu">::</span><span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getPowerRates.html" class="external-link">getPowerRates</a></span><span class="op">(</span></span>
<span>  pi1 <span class="op">=</span> <span class="va">piTreatment</span>, pi2 <span class="op">=</span> <span class="fl">0.2</span>, maxNumberOfSubjects <span class="op">=</span> <span class="fl">38</span><span class="op">+</span><span class="fl">23</span>, </span>
<span>  allocationRatioPlanned <span class="op">=</span> <span class="fl">38</span><span class="op">/</span><span class="fl">23</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">overallReject</span></span></code></pre></div>
<p>The above code is time-consuming and thus executed elsewhere. A plot
visualising the results is shown below:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"img/power_38_23.png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="img%2Fpower_38_23.png"><!-- --></p>
<p>For moderately large effect sizes (treatment success rates approx 0.3
- 0.6), the exact risk difference test offers a larger power than the
normal approximation. Although barely visible in the plot, the exact
risk difference test is slightly more conservative than the normal
approximation for small effect sizes due to its discrete nature. In
contrast to the normal approximation, this means that the “true”
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
level of the exact risk difference test depends on the sample sizes and
may be considerably smaller than the nominal level. For large effect
sizes (treatment success rates &gt; 0.65), the power difference between
the two tests becomes negligible.</p>
</div>
<div class="section level2">
<h2 id="arrival-at-larger-sample-sizes">Arrival at larger sample sizes<a class="anchor" aria-label="anchor" href="#arrival-at-larger-sample-sizes"></a>
</h2>
<p>When entering the territory of large sample sizes, the normal
approximation becomes more accurate. Consider a trial with 200 patients
each in the treatment and control group and event rates of 0.2 under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>.
To compare the performances of the normal approximation and exact risk
difference test, we can identify the rejection region of the exact risk
difference test similar to above:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.2</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.2</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p>The exact risk difference test at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>
proposes the following rejection region:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    reject <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co"># Save for later</span></span>
<span><span class="va">rejectionRegion</span> <span class="op">&lt;-</span> <span class="va">rejectData</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">213</span><span class="op">:</span><span class="fl">217</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability    probGeq reject</span></span>
<span><span class="co">#&gt; [1,]           0.060              0.9410371 0.07515018      0</span></span>
<span><span class="co">#&gt; [2,]           0.065              0.9543523 0.05896286      0</span></span>
<span><span class="co">#&gt; [3,]           0.070              0.9651353 0.04564767      1</span></span>
<span><span class="co">#&gt; [4,]           0.075              0.9737323 0.03486472      1</span></span>
<span><span class="co">#&gt; [5,]           0.080              0.9804803 0.02626772      1</span></span></code></pre></div>
<p>For the given sample sizes, a risk difference of 0.07 or greater
warrants a rejection of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>.
Power calculation for the point alternative
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.4</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.2</annotation></semantics></math>
yields:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.4</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.4</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                    <span class="st">"reject"</span> <span class="op">=</span> <span class="va">rejectionRegion</span><span class="op">)</span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">213</span><span class="op">:</span><span class="fl">217</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rejectData</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability      probGeq reject</span></span>
<span><span class="co">#&gt; [1,]           0.060            0.001106243 9.992400e-01      0</span></span>
<span><span class="co">#&gt; [2,]           0.065            0.001592008 9.988938e-01      0</span></span>
<span><span class="co">#&gt; [3,]           0.070            0.002265348 9.984080e-01      1</span></span>
<span><span class="co">#&gt; [4,]           0.075            0.003187409 9.977347e-01      1</span></span>
<span><span class="co">#&gt; [5,]           0.080            0.004434782 9.968126e-01      1</span></span>
<span><span class="co">#&gt; [6,]           1.000            1.000000000 2.220446e-16      1</span></span></code></pre></div>
<p>Comparing to the normal approximation:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rpact</span><span class="fu">::</span><span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getPowerRates.html" class="external-link">getPowerRates</a></span><span class="op">(</span></span>
<span>  pi1 <span class="op">=</span> <span class="fl">0.4</span>, pi2 <span class="op">=</span> <span class="fl">0.2</span>, maxNumberOfSubjects <span class="op">=</span> <span class="fl">200</span><span class="op">+</span><span class="fl">200</span>, </span>
<span>  allocationRatioPlanned <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><em>Power calculation for a binary endpoint</em></p>
<p>Fixed sample analysis, one-sided significance level 5%. The results
were calculated for a two-sample test for rates (normal approximation),
H0: pi(1) - pi(2) = 0, power directed towards larger values, H1: pi(1) =
0.4, control rate pi(2) = 0.2, number of subjects = 400.</p>
<table class="table">
<thead><tr class="header">
<th>Stage</th>
<th>Fixed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Stage level (one-sided)</td>
<td>0.0500</td>
</tr>
<tr class="even">
<td>Efficacy boundary (z-value scale)</td>
<td>1.645</td>
</tr>
<tr class="odd">
<td>Efficacy boundary (t)</td>
<td>0.070</td>
</tr>
<tr class="even">
<td>Power</td>
<td>0.9973</td>
</tr>
<tr class="odd">
<td>Number of subjects</td>
<td>400.0</td>
</tr>
</tbody>
</table>
<p>Legend:</p>
<ul>
<li>
<em>(t)</em>: treatment effect scale</li>
</ul>
<p>Comparing the two tests in this setting, the exact risk difference
test delivers a marginally larger power, however, this is not relevant
for any practical purposes. Notably, the efficacy boundary on the
treatment scale of the <code>rpact</code> output is identical to the one
proposed by the exact risk difference test.</p>
<p>Using a slightly smaller alternative effect size of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.2</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.3</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.3</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                    <span class="st">"reject"</span> <span class="op">=</span> <span class="va">rejectionRegion</span><span class="op">)</span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">213</span><span class="op">:</span><span class="fl">217</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability   probGeq reject</span></span>
<span><span class="co">#&gt; [1,]           0.060              0.1915069 0.8385539      0</span></span>
<span><span class="co">#&gt; [2,]           0.065              0.2247736 0.8084931      0</span></span>
<span><span class="co">#&gt; [3,]           0.070              0.2610958 0.7752264      1</span></span>
<span><span class="co">#&gt; [4,]           0.075              0.3002232 0.7389042      1</span></span>
<span><span class="co">#&gt; [5,]           0.080              0.3418084 0.6997768      1</span></span></code></pre></div>
<p>Comparing to the normal approximation:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rpact</span><span class="fu">::</span><span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getPowerRates.html" class="external-link">getPowerRates</a></span><span class="op">(</span></span>
<span>  pi1 <span class="op">=</span> <span class="fl">0.3</span>, pi2 <span class="op">=</span> <span class="fl">0.2</span>, maxNumberOfSubjects <span class="op">=</span> <span class="fl">200</span><span class="op">+</span><span class="fl">200</span>, </span>
<span>  allocationRatioPlanned <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><em>Power calculation for a binary endpoint</em></p>
<p>Fixed sample analysis, one-sided significance level 5%. The results
were calculated for a two-sample test for rates (normal approximation),
H0: pi(1) - pi(2) = 0, power directed towards larger values, H1: pi(1) =
0.3, control rate pi(2) = 0.2, number of subjects = 400.</p>
<table class="table">
<thead><tr class="header">
<th>Stage</th>
<th>Fixed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Stage level (one-sided)</td>
<td>0.0500</td>
</tr>
<tr class="even">
<td>Efficacy boundary (z-value scale)</td>
<td>1.645</td>
</tr>
<tr class="odd">
<td>Efficacy boundary (t)</td>
<td>0.070</td>
</tr>
<tr class="even">
<td>Power</td>
<td>0.7483</td>
</tr>
<tr class="odd">
<td>Number of subjects</td>
<td>400.0</td>
</tr>
</tbody>
</table>
<p>Legend:</p>
<ul>
<li>
<em>(t)</em>: treatment effect scale</li>
</ul>
<p>In this case, the additional power that the exact risk difference
provides is already considerable. Moving to an even smaller effect size
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.25</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.2</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.25</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.25</span>, piControl <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                    <span class="st">"reject"</span> <span class="op">=</span> <span class="va">rejectionRegion</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">213</span><span class="op">:</span><span class="fl">217</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability   probGeq reject</span></span>
<span><span class="co">#&gt; [1,]           0.060              0.6178809 0.4286161      0</span></span>
<span><span class="co">#&gt; [2,]           0.065              0.6627374 0.3821191      0</span></span>
<span><span class="co">#&gt; [3,]           0.070              0.7053932 0.3372626      1</span></span>
<span><span class="co">#&gt; [4,]           0.075              0.7453766 0.2946068      1</span></span>
<span><span class="co">#&gt; [5,]           0.080              0.7823196 0.2546234      1</span></span></code></pre></div>
<p>Comparing to the normal approximation:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rpact</span><span class="fu">::</span><span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getPowerRates.html" class="external-link">getPowerRates</a></span><span class="op">(</span></span>
<span>  pi1 <span class="op">=</span> <span class="fl">0.25</span>, pi2 <span class="op">=</span> <span class="fl">0.2</span>, maxNumberOfSubjects <span class="op">=</span> <span class="fl">200</span><span class="op">+</span><span class="fl">200</span>, </span>
<span>  allocationRatioPlanned <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><em>Power calculation for a binary endpoint</em></p>
<p>Fixed sample analysis, one-sided significance level 5%. The results
were calculated for a two-sample test for rates (normal approximation),
H0: pi(1) - pi(2) = 0, power directed towards larger values, H1: pi(1) =
0.25, control rate pi(2) = 0.2, number of subjects = 400.</p>
<table class="table">
<thead><tr class="header">
<th>Stage</th>
<th>Fixed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Stage level (one-sided)</td>
<td>0.0500</td>
</tr>
<tr class="even">
<td>Efficacy boundary (z-value scale)</td>
<td>1.645</td>
</tr>
<tr class="odd">
<td>Efficacy boundary (t)</td>
<td>0.070</td>
</tr>
<tr class="even">
<td>Power</td>
<td>0.3270</td>
</tr>
<tr class="odd">
<td>Number of subjects</td>
<td>400.0</td>
</tr>
</tbody>
</table>
<p>Legend:</p>
<ul>
<li>
<em>(t)</em>: treatment effect scale</li>
</ul>
<p>The power difference is now less pronounced, but still favours the
exact risk difference test.</p>
<p>Comparing the power of the exact risk difference test and the normal
approximation for different treatment success rates:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"img/power_200_200.png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="img%2Fpower_200_200.png"><!-- --></p>
<p>We note that for small treatment effect differences that are close to
or part of the null hypothesis, the exact risk difference offers a
slightly smaller power than the normal approximation. However, this is
to be expected, as the normal approximation can always exhaust the full
alpha level, where as the exact risk difference test is slightly
overconservative in these cases. For larger effect sizes, the exact risk
difference test offers a larger power than the normal approximation, but
these gains in power are fairly small.</p>
</div>
<div class="section level2">
<h2 id="extreme-conditioning---large-and-small-rates">Extreme conditioning - large and small rates<a class="anchor" aria-label="anchor" href="#extreme-conditioning---large-and-small-rates"></a>
</h2>
<p>The normal approximation is usually only accurate for moderate
success rates (unless the sample sizes are extraordinarily large). To
test the performance of the exact risk difference test under extreme
conditions, we presume that, for the trial with 200 patients per group,
the event rate in the control group is now
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.01</annotation></semantics></math>.</p>
<p>We achieve the rejection region as above:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.01</span>, piControl <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.01</span>, piControl <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                    <span class="st">"reject"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">cumProbs</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectionRegion</span> <span class="op">&lt;-</span> <span class="va">rejectData</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># rejectData &lt;- cbind(rejectData,</span></span>
<span>                    <span class="co"># "reachToReject" = c(0, diff(rejectionRegion)),</span></span>
<span>                    <span class="co"># "exceedToReject" = c(diff(rejectionRegion), 0))</span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">202</span><span class="op">:</span><span class="fl">207</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability     probGeq reject</span></span>
<span><span class="co">#&gt; [1,]           0.005              0.7831070 0.396166454      0</span></span>
<span><span class="co">#&gt; [2,]           0.010              0.9008473 0.216892994      0</span></span>
<span><span class="co">#&gt; [3,]           0.015              0.9617363 0.099152721      0</span></span>
<span><span class="co">#&gt; [4,]           0.020              0.9873573 0.038263727      1</span></span>
<span><span class="co">#&gt; [5,]           0.025              0.9963727 0.012642659      1</span></span>
<span><span class="co">#&gt; [6,]           0.030              0.9990847 0.003627275      1</span></span></code></pre></div>
<p>Calculating the corresponding power for success rates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.03</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.03</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.01</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.03</span>, piControl <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">200</span>, nControl <span class="op">=</span> <span class="fl">200</span>, piTreatment <span class="op">=</span> <span class="fl">0.03</span>, piControl <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"Risk difference"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                    <span class="st">"Cumulative probability"</span> <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                    probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                    <span class="st">"reject"</span> <span class="op">=</span> <span class="va">rejectionRegion</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rejectData</span><span class="op">[</span><span class="fl">202</span><span class="op">:</span><span class="fl">207</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      Risk difference Cumulative probability   probGeq reject</span></span>
<span><span class="co">#&gt; [1,]           0.005              0.1833418 0.9008625      0</span></span>
<span><span class="co">#&gt; [2,]           0.010              0.2999130 0.8166582      0</span></span>
<span><span class="co">#&gt; [3,]           0.015              0.4389185 0.7000870      0</span></span>
<span><span class="co">#&gt; [4,]           0.020              0.5829060 0.5610815      1</span></span>
<span><span class="co">#&gt; [5,]           0.025              0.7136828 0.4170940      1</span></span>
<span><span class="co">#&gt; [6,]           0.030              0.8188071 0.2863172      1</span></span></code></pre></div>
<p>We get a decent power of 0.56 for the exact risk difference test
despite the small success rates.</p>
<p>Comparing this to the normal approximation:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rpact</span><span class="fu">::</span><span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getPowerRates.html" class="external-link">getPowerRates</a></span><span class="op">(</span></span>
<span>  pi1 <span class="op">=</span> <span class="fl">0.03</span>, pi2 <span class="op">=</span> <span class="fl">0.01</span>, maxNumberOfSubjects <span class="op">=</span> <span class="fl">200</span><span class="op">+</span><span class="fl">200</span>, </span>
<span>  allocationRatioPlanned <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><em>Power calculation for a binary endpoint</em></p>
<p>Fixed sample analysis, one-sided significance level 5%. The results
were calculated for a two-sample test for rates (normal approximation),
H0: pi(1) - pi(2) = 0, power directed towards larger values, H1: pi(1) =
0.03, control rate pi(2) = 0.01, number of subjects = 400.</p>
<table class="table">
<thead><tr class="header">
<th>Stage</th>
<th>Fixed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Stage level (one-sided)</td>
<td>0.0500</td>
</tr>
<tr class="even">
<td>Efficacy boundary (z-value scale)</td>
<td>1.645</td>
</tr>
<tr class="odd">
<td>Efficacy boundary (t)</td>
<td>0.024</td>
</tr>
<tr class="even">
<td>Power</td>
<td>0.4142</td>
</tr>
<tr class="odd">
<td>Number of subjects</td>
<td>400.0</td>
</tr>
</tbody>
</table>
<p>Legend:</p>
<ul>
<li>
<em>(t)</em>: treatment effect scale</li>
</ul>
<p>The power improvement gained by the exact risk difference test as
compared to the normal approximation is substantial. However, the normal
approximation may not be a solid choice here anyway.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Morten Dreher.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
