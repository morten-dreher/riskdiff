<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to the riskdiff package • riskdiff</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the riskdiff package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">riskdiff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to the riskdiff package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to the riskdiff package</h1>
            
      

      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document provides a brief introduction to discrete risk
differences and to the R package <code>riskdiff</code>. First, load the
package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">riskdiff</span><span class="op">)</span></span></code></pre></div>
<p>Presume that we perform a clinical trial with two groups and a binary
endpoint. This means the comparison of the two rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math>
of the treatment group and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>c</mi></msub><annotation encoding="application/x-tex">\pi_c</annotation></semantics></math>
of the control group. For illustration purposes, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>c</mi></msub><annotation encoding="application/x-tex">\pi_c</annotation></semantics></math>
simply describe the rates of “treatment success” in the treatment and
control group, respectively. In other words, the treatment with the
higher rate is the favourable one for our example and we could formulate
a null hypothesis as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>π</mi><mi>t</mi></msub><mo>≤</mo><msub><mi>π</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">H_0: \pi_t \leq \pi_c</annotation></semantics></math>.
For large enough sample sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>t</mi></msub><annotation encoding="application/x-tex">n_t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>c</mi></msub><annotation encoding="application/x-tex">n_c</annotation></semantics></math>
of treatment and control group, we may use a normal approximation to
answer the research question. However, for very small sample sizes, the
approximation may be inadequate and one may be interested in exact
results. The <code>riskdiff</code> package concerns itself with the
(exact) distribution of risk differences and therefore, these will be
described in detail here. Note that we can rewrite the above null
hypothesis as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>π</mi><mi>t</mi></msub><mo>≤</mo><msub><mi>π</mi><mi>c</mi></msub><mo>⇔</mo><msub><mi>Δ</mi><mi>π</mi></msub><mo>:=</mo><msub><mi>π</mi><mi>t</mi></msub><mo>−</mo><msub><mi>π</mi><mi>c</mi></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_0: \pi_t \leq \pi_c \Leftrightarrow \Delta_\pi:= \pi_t - \pi_c \leq 0</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Δ</mi><mi>π</mi></msub><annotation encoding="application/x-tex">\Delta_\pi</annotation></semantics></math>
denotes the risk difference.</p>
<p>While the risk difference is to be thought of as a real-valued number
between 1 and -1, since it is simply defined by subtracting two rates,
the risk difference observed in a clinical trial is in actuality a
discrete random variable with a finite support. To illustrate this,
presume that we perform an experiment with 4 patients in the treatment
group and 3 patients in the control group (we note that such a trial
will most likely not lead to significant results, but only serves for
illustration purposes here).</p>
<p>For independent patients and groups, we can describe the number of
successes in each group using binomially distributed random variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mo>,</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">i\in\{t,c\}</annotation></semantics></math>
denotes the respective group. Thus,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>t</mi></msub><mo>∼</mo><mi>B</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>4</mn><mo>,</mo><msub><mi>π</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_t \sim Bin(4, \pi_t)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>c</mi></msub><mo>∼</mo><mi>B</mi><mi>i</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>,</mo><msub><mi>π</mi><mi>c</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_c\sim Bin(3, \pi_c)</annotation></semantics></math>
describe the number of successes in the treatment and control group,
respectively.</p>
<p>In both groups, the number of successes which we can observe is
clearly finite (0, 1, 2, 3, 4 successes in the treatment group and 0, 1,
2, 3 successes in the control group), meaning the observed success rates
are a discrete quantity (0/4, 1/4, 2/4, 3/4, 4/4 in the treatment group
and 0/3, 1/3, 2/3, 3/3 in the control group). Since the observed risk
difference is just the difference of these discrete success rates, it is
also a discrete quantity. The possible values it can take can be
visualised in a table:</p>
<table class="table">
<thead><tr class="header">
<th> </th>
<th>0/4</th>
<th>1/4</th>
<th>2/4</th>
<th>3/4</th>
<th>4/4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0/3</strong></td>
<td>0/12</td>
<td>3/12</td>
<td>6/12</td>
<td>9/12</td>
<td>12/12</td>
</tr>
<tr class="even">
<td><strong>1/3</strong></td>
<td>-4/12</td>
<td>-1/12</td>
<td>2/12</td>
<td>5/12</td>
<td>8/12</td>
</tr>
<tr class="odd">
<td><strong>2/3</strong></td>
<td>-8/12</td>
<td>-5/12</td>
<td>-2/12</td>
<td>1/12</td>
<td>4/12</td>
</tr>
<tr class="even">
<td><strong>3/3</strong></td>
<td>-12/12</td>
<td>-9/12</td>
<td>-6/12</td>
<td>-3/12</td>
<td>0/12</td>
</tr>
</tbody>
</table>
<p>Each table entry is taken by subtracting the number of successes in
the control group (displayed by the row names) from the number of
successes in the treatment group (displayed by the column names). For
ease of presentation, the common denominator 12 is used for all
entries.</p>
<p>From the table, two things become apparent: 1) Not every value can be
reached (e.g., a risk difference of 11/12 is not possible with the given
sample sizes). 2) Some values may occur more than once. For example, a
risk difference of 0/12 can occur either if all patients experience a
treatment success or if all patients experience a treatment failure.
This phenomenon always occurs for a risk difference of 0, regardless of
the sample sizes, and may also occur for other risk differences, if the
group sizes are not coprime (consider group sizes 8 and 4, where a risk
difference of 8/32 can be reached via 8/8 and 3/4 successes, 6/8 and 2/4
successes, 4/8 and 1/4 successes as well as 2/8 and 0/4 successes).</p>
<p>Since the two groups and the patients within them are assumed to be
independent, the probability of each risk difference in the table
occurring is simply calculated by multiplying the marginal
probabilities. Assuming the success probabilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.6</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_c=0.3</annotation></semantics></math>,
the calculation of the probabilities is straightforward. For example,
the probability of the observed risk difference being 12/12 is simply
the probability of observing 4 successes in the treatment group times
the probability of observing 0 successes in the control group:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Δ</mi><mi>π</mi></msub><mo>=</mo><mn>12</mn><mi>/</mi><mn>12</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo>=</mo><mn>4</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>c</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mn>4</mn><mn>4</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mn>0.6</mn><mn>4</mn></msup><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mn>3</mn><mn>0</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>0.3</mn><mo stretchy="true" form="postfix">)</mo></mrow><mn>3</mn></msup><mo>=</mo><mn>0.0445</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">
P(\Delta_\pi = 12/12) = P(X_t=4) \cdot P(X_c=0) = \binom{4}{4}0.6^4\cdot \binom{3}{0}(1-0.3)^3 = 0.0445.
</annotation></semantics></math></p>
<p>Completing the table yields the probabilities:</p>
<table class="table">
<thead><tr class="header">
<th> </th>
<th>0/4</th>
<th>1/4</th>
<th>2/4</th>
<th>3/4</th>
<th>4/4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0/3</strong></td>
<td>0.0088</td>
<td>0.0527</td>
<td>0.1185</td>
<td>0.1185</td>
<td>0.0445</td>
</tr>
<tr class="even">
<td><strong>1/3</strong></td>
<td>0.0113</td>
<td>0.0677</td>
<td>0.1524</td>
<td>0.1524</td>
<td>0.0572</td>
</tr>
<tr class="odd">
<td><strong>2/3</strong></td>
<td>0.0048</td>
<td>0.0290</td>
<td>0.0653</td>
<td>0.0653</td>
<td>0.0245</td>
</tr>
<tr class="even">
<td><strong>3/3</strong></td>
<td>0.0007</td>
<td>0.0041</td>
<td>0.0093</td>
<td>0.0093</td>
<td>0.0035</td>
</tr>
</tbody>
</table>
<p>Alternatively, we could calculate a scenario under our aforementioned
null hypothesis, e.g. for equal success rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_t = \pi_c = 0.3</annotation></semantics></math>,
equating to a risk difference
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>π</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\Delta_\pi=0</annotation></semantics></math>.</p>
<p>This yields the probability table:</p>
<table class="table">
<thead><tr class="header">
<th> </th>
<th>0/4</th>
<th>1/4</th>
<th>2/4</th>
<th>3/4</th>
<th>4/4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>0/3</strong></td>
<td>0.0824</td>
<td>0.1412</td>
<td>0.0908</td>
<td>0.0259</td>
<td>0.0028</td>
</tr>
<tr class="even">
<td><strong>1/3</strong></td>
<td>0.1059</td>
<td>0.1815</td>
<td>0.1167</td>
<td>0.0333</td>
<td>0.0036</td>
</tr>
<tr class="odd">
<td><strong>2/3</strong></td>
<td>0.0454</td>
<td>0.0778</td>
<td>0.0500</td>
<td>0.0143</td>
<td>0.0015</td>
</tr>
<tr class="even">
<td><strong>3/3</strong></td>
<td>0.0065</td>
<td>0.0111</td>
<td>0.0071</td>
<td>0.0020</td>
<td>0.0002</td>
</tr>
</tbody>
</table>
<p>We may summarise and order these probabilities by their risk
differences. When summarising, we must keep in mind that, as mentioned
above, a risk difference of 0 can be reached by two combinations (all
successes or all failures). Accordingly, we must sum up both
probabilities for the overall probability of a risk difference of 0.
However, note the vast differences of these probabilities: the
probability of all failures is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0824</mn><annotation encoding="application/x-tex">0.0824</annotation></semantics></math>,
whereas the probability of all successes is merely
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0002</mn><annotation encoding="application/x-tex">0.0002</annotation></semantics></math>.
It may be questionable to treat these situations in the same way.
Regardless, this is a feature that occurs when reducing the complexity
of the investigated hypothesis from two dimensions
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>c</mi></msub><annotation encoding="application/x-tex">\pi_c</annotation></semantics></math>)
to one dimension
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Δ</mi><mi>π</mi></msub><annotation encoding="application/x-tex">\Delta_\pi</annotation></semantics></math>).</p>
<table class="table">
<thead><tr class="header">
<th>Risk difference</th>
<th>Probability</th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>-12/12</td>
<td>0.0065</td>
<td></td>
</tr>
<tr class="even">
<td>-9/12</td>
<td>0.0111</td>
<td></td>
</tr>
<tr class="odd">
<td>-8/12</td>
<td>0.0454</td>
<td></td>
</tr>
<tr class="even">
<td>-6/12</td>
<td>0.0071</td>
<td></td>
</tr>
<tr class="odd">
<td>-5/12</td>
<td>0.0778</td>
<td></td>
</tr>
<tr class="even">
<td>-4/12</td>
<td>0.1059</td>
<td></td>
</tr>
<tr class="odd">
<td>-3/12</td>
<td>0.0020</td>
<td></td>
</tr>
<tr class="even">
<td>-2/12</td>
<td>0.0500</td>
<td></td>
</tr>
<tr class="odd">
<td>-1/12</td>
<td>0.1815</td>
<td></td>
</tr>
<tr class="even">
<td>0/12</td>
<td>0.0826</td>
<td></td>
</tr>
<tr class="odd">
<td>1/12</td>
<td>0.0142</td>
<td></td>
</tr>
<tr class="even">
<td>2/12</td>
<td>0.1167</td>
<td></td>
</tr>
<tr class="odd">
<td>3/12</td>
<td>0.1412</td>
<td></td>
</tr>
<tr class="even">
<td>4/12</td>
<td>0.0015</td>
<td></td>
</tr>
<tr class="odd">
<td>5/12</td>
<td>0.0333</td>
<td></td>
</tr>
<tr class="even">
<td>6/12</td>
<td>0.0908</td>
<td></td>
</tr>
<tr class="odd">
<td>8/12</td>
<td>0.0036</td>
<td></td>
</tr>
<tr class="even">
<td>9/12</td>
<td>0.0259</td>
<td></td>
</tr>
<tr class="odd">
<td>12/12</td>
<td>0.0028</td>
<td></td>
</tr>
</tbody>
</table>
<p>Plotting the individual probabilities against the risk difference
yields an interesting picture:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">-</span><span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span><span class="op">)</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0065</span>,<span class="fl">0.0111</span>, <span class="fl">0.0454</span>, <span class="fl">0.0071</span>, <span class="fl">0.0778</span>, <span class="fl">0.1059</span>, <span class="fl">0.0020</span>, <span class="fl">0.0500</span>, </span>
<span>           <span class="fl">0.1815</span>, <span class="fl">0.0826</span>, <span class="fl">0.0142</span>, <span class="fl">0.1167</span>, <span class="fl">0.1412</span>, <span class="fl">0.0015</span>, <span class="fl">0.0333</span>, <span class="fl">0.0908</span>, </span>
<span>           <span class="fl">0.0036</span>, <span class="fl">0.0259</span>, <span class="fl">0.0028</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">probs</span>, xlab <span class="op">=</span> <span class="st">"Risk difference"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Risk difference distribution under H0"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">probs</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<p>Clearly, the distribution of the risk difference is not symmetric
around 0 under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>.
Furthermore, the probability of observing a risk difference of 0 is
rather low, compared to other values in the vicinity. The reasoning for
this is intuitive, as for the given example of coprime sample sizes, a
risk difference of 0 will only be achieved if a treatment success is
observed for all patients in the trial or if a treatment failure is
observed for all patients in the trial. With the assumed moderate
success probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.3</mn><annotation encoding="application/x-tex">0.3</annotation></semantics></math>,
neither of these events is overwhelmingly likely.</p>
<p>Under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>,
the most likely risk difference to be observed is -1/12, with a
probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.1815</mn><annotation encoding="application/x-tex">0.1815</annotation></semantics></math>.
We may also investigate the cumulative risk difference distribution
under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
by simply using the cumulative sum of the probabilities:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">cumProbs</span>, xlab <span class="op">=</span> <span class="st">"Risk difference"</span>, ylab <span class="op">=</span> <span class="st">"Cumulative Probability"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Cumulative risk difference distribution under H0"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">rds</span>, <span class="va">cumProbs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">cumProbs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0.95</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>As illustrated by the red lines, the risk difference 0 clearly does
not constitute the centre of the distribution, as the probability to
observe a risk difference of at most 0 exceeds 0.5, which would be
expected for a symmetric distribution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rds</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">cumProbs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.5699</span></span></code></pre></div>
<p>We may design a simple (one-sided) level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
statistical test for this situation by rejecting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
for risk differences with a cumulative probability that exceeds
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">1-\alpha</annotation></semantics></math>.
We use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha=0.05</annotation></semantics></math>
for illustration. Note that for the comparison, we must subtract the
concrete probabilities of achieving the specific risk difference to
maintain the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
level. In the plot above, the blue horizontal line indicates the
cumulative probability of 0.95.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>riskDifference <span class="op">=</span> <span class="va">rds</span>, cumulativeProbability <span class="op">=</span> <span class="va">cumProbs</span>,</span>
<span>                         probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span> <span class="op">+</span> <span class="va">probs</span>,</span>
<span>                         reject <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span> <span class="op">+</span> <span class="va">probs</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">rejectData</span></span>
<span><span class="co">#&gt;    riskDifference cumulativeProbability probGeq reject</span></span>
<span><span class="co">#&gt; 1     -1.00000000                0.0065  1.0000  FALSE</span></span>
<span><span class="co">#&gt; 2     -0.75000000                0.0176  0.9935  FALSE</span></span>
<span><span class="co">#&gt; 3     -0.66666667                0.0630  0.9824  FALSE</span></span>
<span><span class="co">#&gt; 4     -0.50000000                0.0701  0.9370  FALSE</span></span>
<span><span class="co">#&gt; 5     -0.41666667                0.1479  0.9299  FALSE</span></span>
<span><span class="co">#&gt; 6     -0.33333333                0.2538  0.8521  FALSE</span></span>
<span><span class="co">#&gt; 7     -0.25000000                0.2558  0.7462  FALSE</span></span>
<span><span class="co">#&gt; 8     -0.16666667                0.3058  0.7442  FALSE</span></span>
<span><span class="co">#&gt; 9     -0.08333333                0.4873  0.6942  FALSE</span></span>
<span><span class="co">#&gt; 10     0.00000000                0.5699  0.5127  FALSE</span></span>
<span><span class="co">#&gt; 11     0.08333333                0.5841  0.4301  FALSE</span></span>
<span><span class="co">#&gt; 12     0.16666667                0.7008  0.4159  FALSE</span></span>
<span><span class="co">#&gt; 13     0.25000000                0.8420  0.2992  FALSE</span></span>
<span><span class="co">#&gt; 14     0.33333333                0.8435  0.1580  FALSE</span></span>
<span><span class="co">#&gt; 15     0.41666667                0.8768  0.1565  FALSE</span></span>
<span><span class="co">#&gt; 16     0.50000000                0.9676  0.1232  FALSE</span></span>
<span><span class="co">#&gt; 17     0.66666667                0.9712  0.0324   TRUE</span></span>
<span><span class="co">#&gt; 18     0.75000000                0.9971  0.0288   TRUE</span></span>
<span><span class="co">#&gt; 19     1.00000000                0.9999  0.0029   TRUE</span></span></code></pre></div>
<p>In the data frame above, the column <code>probGeq</code> indicates
the probability of achieving a risk difference greater or equal than the
respective value. For a valid (discrete)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
level test, we may only reject risk differences for which this
probability is less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
Using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.05</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
can be rejected for risk differences of 0.66 or greater. The true type I
error rate of this test is thus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0324</mn><annotation encoding="application/x-tex">0.0324</annotation></semantics></math>
and the resulting test will be conservative, which is not surprising for
a discrete test.</p>
<p>We may simulate:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4242</span><span class="op">)</span></span>
<span><span class="va">nSims</span> <span class="op">&lt;-</span> <span class="fl">1000000</span></span>
<span></span>
<span><span class="va">successTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">4</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">successControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">3</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskDifferences</span> <span class="op">&lt;-</span> <span class="va">successTreatment</span><span class="op">/</span><span class="fl">4</span> <span class="op">-</span> <span class="va">successControl</span><span class="op">/</span><span class="fl">3</span></span>
<span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">riskDifferences</span> <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.032424</span></span></code></pre></div>
<p>The simulated and theoretical type I error rates are in good
agreement.</p>
<p>We will now attempt a power calculation and simulation for the same
group sizes, but assuming the event rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\pi_t = 0.6</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>c</mi></msub><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\pi_c = 0.3</annotation></semantics></math>.
The <code><a href="../reference/priskdiff.html">priskdiff()</a></code> and <code><a href="../reference/driskdiff.html">driskdiff()</a></code> functions from
the <code>riskdiff</code> facilitate the calculation and
<code><a href="../reference/plotriskdiff.html">plotriskdiff()</a></code> visualises the result:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/driskdiff.html">driskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">4</span>, nControl <span class="op">=</span> <span class="fl">3</span>, piTreatment <span class="op">=</span> <span class="fl">0.6</span>, piControl <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span> <span class="op">&lt;-</span> <span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/priskdiff.html">priskdiff</a></span><span class="op">(</span>nTreatment <span class="op">=</span> <span class="fl">4</span>, nControl <span class="op">=</span> <span class="fl">3</span>, piTreatment <span class="op">=</span> <span class="fl">0.6</span>, piControl <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">cumProbs</span></span>
<span><span class="co">#&gt;    Risk difference Cumulative probability</span></span>
<span><span class="co">#&gt; 1      -1.00000000              0.0006912</span></span>
<span><span class="co">#&gt; 2      -0.75000000              0.0048384</span></span>
<span><span class="co">#&gt; 3      -0.66666667              0.0096768</span></span>
<span><span class="co">#&gt; 4      -0.50000000              0.0190080</span></span>
<span><span class="co">#&gt; 5      -0.41666667              0.0480384</span></span>
<span><span class="co">#&gt; 6      -0.33333333              0.0593280</span></span>
<span><span class="co">#&gt; 7      -0.25000000              0.0686592</span></span>
<span><span class="co">#&gt; 8      -0.16666667              0.1339776</span></span>
<span><span class="co">#&gt; 9      -0.08333333              0.2017152</span></span>
<span><span class="co">#&gt; 10      0.00000000              0.2139952</span></span>
<span><span class="co">#&gt; 11      0.08333333              0.2793136</span></span>
<span><span class="co">#&gt; 12      0.16666667              0.4317232</span></span>
<span><span class="co">#&gt; 13      0.25000000              0.4844080</span></span>
<span><span class="co">#&gt; 14      0.33333333              0.5089024</span></span>
<span><span class="co">#&gt; 15      0.41666667              0.6613120</span></span>
<span><span class="co">#&gt; 16      0.50000000              0.7798528</span></span>
<span><span class="co">#&gt; 17      0.66666667              0.8370064</span></span>
<span><span class="co">#&gt; 18      0.75000000              0.9555472</span></span>
<span><span class="co">#&gt; 19      1.00000000              1.0000000</span></span>
<span><span class="fu">riskdiff</span><span class="fu">::</span><span class="fu"><a href="../reference/plotriskdiff.html">plotriskdiff</a></span><span class="op">(</span><span class="va">cumProbs</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>From above, we learned that our test rejects for risk differences of
0.66 or greater (or for risk differences truly greater than 0.5). We may
now calculate the power of our test for this situation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rejectData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cumProbs</span>, probGeq <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">cumProbs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rejectData</span></span>
<span><span class="co">#&gt;    Risk difference Cumulative probability   probGeq</span></span>
<span><span class="co">#&gt; 1      -1.00000000              0.0006912 1.0000000</span></span>
<span><span class="co">#&gt; 2      -0.75000000              0.0048384 0.9993088</span></span>
<span><span class="co">#&gt; 3      -0.66666667              0.0096768 0.9951616</span></span>
<span><span class="co">#&gt; 4      -0.50000000              0.0190080 0.9903232</span></span>
<span><span class="co">#&gt; 5      -0.41666667              0.0480384 0.9809920</span></span>
<span><span class="co">#&gt; 6      -0.33333333              0.0593280 0.9519616</span></span>
<span><span class="co">#&gt; 7      -0.25000000              0.0686592 0.9406720</span></span>
<span><span class="co">#&gt; 8      -0.16666667              0.1339776 0.9313408</span></span>
<span><span class="co">#&gt; 9      -0.08333333              0.2017152 0.8660224</span></span>
<span><span class="co">#&gt; 10      0.00000000              0.2139952 0.7982848</span></span>
<span><span class="co">#&gt; 11      0.08333333              0.2793136 0.7860048</span></span>
<span><span class="co">#&gt; 12      0.16666667              0.4317232 0.7206864</span></span>
<span><span class="co">#&gt; 13      0.25000000              0.4844080 0.5682768</span></span>
<span><span class="co">#&gt; 14      0.33333333              0.5089024 0.5155920</span></span>
<span><span class="co">#&gt; 15      0.41666667              0.6613120 0.4910976</span></span>
<span><span class="co">#&gt; 16      0.50000000              0.7798528 0.3386880</span></span>
<span><span class="co">#&gt; 17      0.66666667              0.8370064 0.2201472</span></span>
<span><span class="co">#&gt; 18      0.75000000              0.9555472 0.1629936</span></span>
<span><span class="co">#&gt; 19      1.00000000              1.0000000 0.0444528</span></span></code></pre></div>
<p>According to this calculation, the probability of reaching or
exceeding a risk difference of 0.66 is 0.22, which is the power in this
scenario.</p>
<p>We may simulate:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">successTreatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">4</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">successControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nSims</span>, <span class="fl">3</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">riskDifferences</span> <span class="op">&lt;-</span> <span class="va">successTreatment</span><span class="op">/</span><span class="fl">4</span> <span class="op">-</span> <span class="va">successControl</span><span class="op">/</span><span class="fl">3</span></span>
<span></span>
<span><span class="va">reject</span> <span class="op">&lt;-</span> <span class="va">riskDifferences</span> <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">reject</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.219335</span></span></code></pre></div>
<p>Again, the simulated and theoretical power rates are almost
identical.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Morten Dreher.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
